import{f as P,a0 as v,n as g,o as x,c as E,a as W,s as $,A as p,y as w,b as N,v as U,H as J,af as K,_ as k,aZ as V,r as Q,b4 as X,p as Y,b5 as tt,w as et,W as F,b6 as ot,P as at}from"./index-y-IgYf6E.js";import{_ as st}from"./BFormSelect.vue_vue_type_script_setup_true_lang-BigptVap-Dd8FLBDt.js";import{u as L,i as O,a as S,b as A,c as B,d as I,E as D}from"./installCanvasRenderer-BpNB3XR3.js";import{m as R,c as z,e as M,i as j,b as rt,f as q,d as nt,j as it}from"./chartZoom-B-0dVpED.js";function lt(i,t){const n=Math.min(...i),d=(Math.max(...i)-n)*1.01/t,u=[...Array(t).keys()].map(r=>[Math.round((n+r*d)*1e3)/1e3,0]);for(let r=0;r<i.length;r++){const o=Math.min(Math.floor((i[r]-n)/d),t-1);isNaN(o)||u[o][1]++}return u}const ct={class:"d-flex flex-column h-100 position-relative"},mt={class:"flex-grow-1"},T="Trade count",dt=P({__name:"ProfitDistributionChart",props:{trades:{required:!0,type:Array},showTitle:{default:!0,type:Boolean}},setup(i){L([R,O,S,z,A,B,I]);const t=i,n=v(),y=[{text:"10",value:10},{text:"15",value:15},{text:"20",value:20},{text:"25",value:25},{text:"50",value:50}],d=g(()=>{const r=t.trades.map(o=>o.profit_ratio);return lt(r,n.profitDistributionBins)}),u=g(()=>({title:{text:"Profit distribution",show:t.showTitle},backgroundColor:"rgba(0, 0, 0, 0)",dataset:{source:d.value},tooltip:{trigger:"axis",axisPointer:{type:"line",label:{backgroundColor:"#6a7985"}}},legend:{data:[T],right:"5%",selectedMode:!1},xAxis:{type:"category",name:"Profit %",nameLocation:"middle",nameGap:25},yAxis:[{type:"value",name:T,splitLine:{show:!1},nameRotate:90,nameLocation:"middle",nameGap:35,position:"left"}],grid:{...M,bottom:50},series:[{type:"bar",name:T,animation:!0,encode:{x:"x0",y:"y0"}}]}));return(r,o)=>{const m=st,b=K;return x(),E("div",ct,[W("div",mt,[i.trades?(x(),$(p(D),{key:0,option:p(u),autoresize:"",theme:p(n).chartTheme},null,8,["option","theme"])):w("",!0)]),N(b,{class:J(["z-2 position-absolute fixed-top",{"mx-auto":i.showTitle}]),label:"Bins",style:{width:"33%","min-width":"12rem"},"label-for":"input-bins","label-cols":"6","content-cols":"6",size:"sm"},{default:U(()=>[N(m,{id:"input-bins",modelValue:p(n).profitDistributionBins,"onUpdate:modelValue":o[0]||(o[0]=e=>p(n).profitDistributionBins=e),size:"sm",class:"mt-1",options:y},null,8,["modelValue"])]),_:1},8,["class"])])}}}),gt=k(dt,[["__scopeId","data-v-90a95a84"]]),C="Profit",pt=P({__name:"CumProfitChart",props:{trades:{required:!0,type:Array},openTrades:{required:!1,type:Array,default:()=>[]},showTitle:{default:!0,type:Boolean},profitColumn:{default:"profit_abs",type:String}},setup(i){L([R,j,O,S,z,rt,A,B,I]);const t=i,n=v(),y=V(),d=Q(),u=g(()=>t.openTrades.reduce((e,a)=>e+(a.total_profit_abs??a[t.profitColumn]??0),0)),r=g(()=>{const e=[],a={},l=t.trades.slice().sort((c,_)=>c.close_timestamp>_.close_timestamp?1:-1);let f=0;for(let c=0,_=l.length;c<_;c+=1){const s=l[c];s.close_timestamp&&s[t.profitColumn]&&(f+=s[t.profitColumn],a[s.close_timestamp]?(a[s.close_timestamp].profit+=s[t.profitColumn],a[s.close_timestamp][s.botId]?a[s.close_timestamp][s.botId]+=s[t.profitColumn]:a[s.close_timestamp][s.botId]=f):a[s.close_timestamp]={profit:f,[s.botId]:f},e.push({date:s.close_timestamp,profit:f,[s.botId]:f}))}const h=Object.entries(a).map(([c,_])=>({date:parseInt(c,10),profit:_.profit}));if(t.openTrades.length>0){let c=0,_=0;if(h.length>0){const G=h[h.length-1];c=G.profit??0,_=G.date??0}else _=t.openTrades[0].open_timestamp;const s=(c??0)+u.value;h.push({date:_,currentProfit:c});const Z=Date.now()+24*60*60*1e3;h.push({date:Z,currentProfit:s})}return h});function o(e=!1){const{colorProfit:a,colorLoss:l}=y;return{dataset:{dimensions:["date","profit","currentProfit"],source:r.value},series:[{type:"line",name:"currentProfit",animation:e,lineStyle:{color:u.value>0?a:l,type:"dotted"},itemStyle:{color:u.value>0?a:l},encode:{x:"date",y:"currentProfit"}},{type:"line",name:C,animation:e,step:"end",lineStyle:{color:n.chartTheme==="dark"?"#c2c2c2":"black"},itemStyle:{color:n.chartTheme==="dark"?"#c2c2c2":"black"},encode:{x:"date",y:"profit"}}]}}function m(e=!1){var l;const a=o(e);(l=d.value)==null||l.setOption(a,{replaceMerge:["series","dataset"]})}const b=X(()=>t.trades,()=>{const e={title:{text:"Cumulative Profit",left:"center",show:t.showTitle},backgroundColor:"rgba(0, 0, 0, 0)",tooltip:{trigger:"axis",formatter:l=>{const f=l[0].data.profit,h=l[0].data.currentProfit,c=h?`Projected profit (incl. unrealized): ${F(h,3)}`:`Profit: ${F(f,3)}`;return`${ot(l[1].data.date)}<br />${l[1].marker}${c}`},axisPointer:{type:"line",label:{backgroundColor:"#6a7985"}}},legend:{data:[C],right:"5%",selectedMode:!1},useUTC:!1,xAxis:{type:"time"},yAxis:[{type:"value",name:C,splitLine:{show:!1},nameRotate:90,nameLocation:"middle",nameGap:40}],grid:{...M},dataZoom:[{type:"inside",start:0,end:100},{bottom:10,start:0,end:100,...q}]},a=o(!1);return e.series=a.series,e.dataset=a.dataset,e});return Y(()=>{}),tt(()=>t.openTrades,()=>{m()},{throttle:60*1e3}),et(()=>n.chartTheme,()=>{b.trigger()}),(e,a)=>i.trades?(x(),$(p(D),{key:0,ref_key:"chart",ref:d,option:p(b),theme:p(n).chartTheme,autoresize:""},null,8,["option","theme"])):w("",!0)}}),xt=k(pt,[["__scopeId","data-v-187abcc1"]]),H="Profit %",ut="#9be0a8",ft=P({__name:"TradesLogChart",props:{trades:{required:!0,type:Array},showTitle:{default:!0,type:Boolean}},setup(i){L([R,j,O,S,z,A,B,I,nt,it]);const t=i,n=v(),y=V(),d=g(()=>{const r=[],o=t.trades.slice(0).sort((m,b)=>m.close_timestamp>b.close_timestamp?1:-1);for(let m=0,b=o.length;m<b;m+=1){const e=o[m],a=[m,(e.profit_ratio*100).toFixed(2),e.pair,e.botName,at(e.close_timestamp),e.is_short===void 0||!e.is_short?"Long":"Short"];r.push(a)}return r}),u=g(()=>{const r=d.value.length>0?(1-50/d.value.length)*100:100;return console.log(r),{title:{text:"Trades log",left:"center",show:t.showTitle},backgroundColor:"rgba(0, 0, 0, 0)",dataset:{dimensions:["date","profit"],source:d.value},tooltip:{trigger:"axis",formatter:o=>{const m=o[0].data[3]?` | ${o[0].data[3]}`:"";return`${o[0].data[2]} | ${o[0].data[5]} ${m}<br>${o[0].data[4]}<br>Profit ${o[0].data[1]} %`},axisPointer:{type:"line",label:{backgroundColor:"#6a7985"}}},xAxis:{type:"category",show:!1},yAxis:[{type:"value",name:H,splitLine:{show:!1},nameRotate:90,nameLocation:"middle",nameGap:30}],grid:{...M,left:80},dataZoom:[{type:"inside",start:r,end:100},{bottom:10,start:r,end:100,...q}],visualMap:[{show:!0,seriesIndex:0,pieces:[{max:0,color:y.colorLoss},{min:0,color:y.colorProfit}]}],series:[{type:"bar",name:H,barCategoryGap:"0%",animation:!1,label:{show:!0,position:"top",rotate:90,offset:[7.5,7.5],formatter:"{@[1]} %",color:n.chartTheme==="dark"?"#c2c2c2":"#3c3c3c"},encode:{x:0,y:1},itemStyle:{color:ut}}]}});return(r,o)=>i.trades.length>0?(x(),$(p(D),{key:0,option:p(u),autoresize:"",theme:p(n).chartTheme},null,8,["option","theme"])):w("",!0)}}),Tt=k(ft,[["__scopeId","data-v-32230266"]]);export{Tt as _,xt as a,gt as b};
//# sourceMappingURL=TradesLogChart-BugI9k-Y.js.map
